// Generated by CoffeeScript 1.4.0
(function() {

  Class('InfoCustomImage')({
    prototype: {
      init: function(element, initData, numberCombination) {
        this.element = typeof element === 'string' ? $(element) : element;
        this.customimageUrl = '/images/image-place-holder.png';
        this.template = this.element.find('.custom-image-template').html();
        this.element.find('.custom-image-placeholder').html('').append(this.template);
        this.thumbContainer = this.element.find('.thumb-container');
        this.imageThumb = this.element.find('.image-thumb');
        this.layoutOptions = this.element.find('.layout-options');
        this.uploadInput = this.element.find('.image-preview');
        this.layout = this.element.find('.graphic-layout');
        this.imageThumb.attr('src', this.customimageUrl);
        this.bindEvents();
        if (initData) {
          this.initData = initData;
          this.setEditionMode();
        }
        if (numberCombination) {
          this.layoutOptions.hide();
        }
        return this.element.show();
      },
      bindEvents: function() {
        var _this = this;
        return this.uploadInput.change(function() {
          return _this.uploadImage();
        });
      },
      uploadImage: function() {
        var _this = this;
        return this.uploadInput.upload('/admin/image_preview', function(data) {
          _this.thumbContainer.show();
          _this.imageThumb.attr('src', data.url);
          _this.element.trigger('infoEditorChange.custom-image');
          return _this.customimageUrl = data.url;
        }, 'json');
      },
      setEditionMode: function() {
        this.thumbContainer.show();
        this.imageThumb.attr('src', this.initData.graphic);
        this.customimageUrl = this.initData.graphic;
        return this.layout.val(this.initData.layout);
      },
      getData: function() {
        var result;
        return result = {
          graphic: this.customimageUrl,
          layout: this.layout.val()
        };
      }
    }
  });

}).call(this);
