<%
    infosidebarIsPresent = false
    if !@blocks.empty?
      if params[:tags].present? || params['all'].present?
        infosidebarIsPresent = true
      end
    end
 %>
<script type="text/template" id="timeline-deactivated">
  <li class="timeliner disactivated-timeliner" data-year="{{year}}">
    <a href="#"><span class="timerliner-dot"></span><span class="year-label"><span class="inner-dot-icn"></span><span class="year-text">{{year}}</span></span></a>
  </li>
</script>
<div class="top-scroll" style="z-index:1;position:fixed;cursor:n-resize;width: 100%; height: 50px; right: 60px"></div>
<div class="bottom-scroll" style="z-index:1;position:fixed;cursor:s-resize;width: 100%; height: 50px; right: 60px"></div>
<div class="sweeper panel-padding">

  <div class="updating-wrapper" <%= "style=\"background-image:url('#{@voice.background}')\"".html_safe if !@voice.background.blank? %> <%= "data-background-loading-image=\"#{@voice.background}\"".html_safe if !@voice.background.blank? %> >
    <div class="image-bg-patter">
      <div class="loading-hldr">
        <div class="loading-wrapper">
          <div class="spinner">
            <%= image_tag '/images/loader-posts.gif', :border => '0' %>
            <p>Loading Voice</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!--style type="text/css" class="posts-style">
    /*placeholder for dynamically calculated posts styles*/
    /* used by mediafeed_init.js/setPostsmeasures()*/
  </style-->

  <!-- infographics sidebar render only on POSTS WALL view -->
  <% if  infosidebarIsPresent && !is_mobile? %>
    <%= render :partial => "voices/info-sidebar" %>
  <% end %>

  <div class="voices-scroller scroll-primary <%= 'with-infosidebar' if infosidebarIsPresent %>">
    <div class="voices-container initial-state <%= 'with-announcement' if @voice.announcement.present? %>">
    </div>
  </div>

  <script type="text/javascript">
    $(document).ready(function(){

      window.voicesContainer = new VoicesContainer({
        name     : 'voicesContainer',
        element  : $('.voices-container')
      });
      
      var voice;

    <% @posts.each  do |post| %>

      <% if params[:tags].present? #TODO pass to a helper
        url = voice_url(@voice, :post => post.id, :tags=>params[:tags])
      elsif params[:all].present?
        url = voice_url(@voice, :post => post.id, :all=>1)
      elsif params[:filters].present?
        url = voice_url(@voice, :post => post.id, :all=>1)
      else
        url = voice_url(@voice, :post => post.id)
      end %>

      voice = new VoiceElement({
        name          : 'post_' + <%= post.id %>,
        id            : <%= post.id %>,
        URL           : "<%= url %>",
        postURL       : "<%= post.is_raw_image? ? post.image.url : post.source_url %>",
        apporved      : <%= post.approved? %>,
        description   : "<%= get_excerpt(post.description, 250) if post.description && post.description != '(no description)' %>",
        longDesc      : "<%= post.description %>",
        imageWidth    : <%= post.image_width %>,
        imageHeight   : <%= post.image_height %>,
        thumbURL      : "<%= post.image.thumb.url %>",
        negativeVotes : <%= post.negative_votes_count %>,
        positiveVotes : <%= post.positive_votes_count %>,
        overallScore  : <%= post.overall_score %>,
        sourceService : "<%= post.source_service %>",
        sourceType    : "<%= post.source_type %>",
        sourceURL     : "<%= post.source_url %>",
        title         : "<%= post.title if post.title != '(no title)' %>",
        voiceID       : <%= post.voice_id %>,
        createdAt     : "<%= post.created_at.beginning_of_day.to_date %>",
        timeAgo       : "<%= time_ago_in_words(post.created_at) %>",
        service       : "<%= post.source_url.nil? ? Post.detect_service(post.source_url) : post.source_url %>"
      });

      voice.render(window.voicesContainer.element);
      window.voicesContainer.appendChild(voice);
    <% end %>
    });
  </script>

  

  <ul class="timeliner-group <%= 'with-announcement' if @voice.announcement.present? %>">
    <li class="post-fetch-trigger timeline-tab _medium-font">See More</li>
    <li class="timeliner current">
      <div id="slider-vertical"></div>
    </li>
  </ul>
</div>


